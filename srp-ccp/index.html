<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="https://wanted2.github.io/assets/images/favicon.ico">

<title>Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất | AiFi</title>



<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất | AiFi</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất" />
<meta name="author" content="tuan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Quy tắc trách nhiệm đơn (SRP, [2]) là nguyên tắc đầu tiên trong SOLID [2], và có thể khái quát như là: A module should be responsible to one, and only one, actor. Một module phần mềm chỉ nên phục vụ 1 và chỉ 1 đối tượng sử dụng." />
<meta property="og:description" content="Quy tắc trách nhiệm đơn (SRP, [2]) là nguyên tắc đầu tiên trong SOLID [2], và có thể khái quát như là: A module should be responsible to one, and only one, actor. Một module phần mềm chỉ nên phục vụ 1 và chỉ 1 đối tượng sử dụng." />
<meta property="og:site_name" content="AiFi" />
<meta property="og:image" content="/https://wanted2.github.io/assets/images/srp-and-ccp.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-07T00:00:00+09:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/https://wanted2.github.io/assets/images/srp-and-ccp.jpeg" />
<meta property="twitter:title" content="Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"/https://wanted2.github.io/srp-ccp/"},"description":"Quy tắc trách nhiệm đơn (SRP, [2]) là nguyên tắc đầu tiên trong SOLID [2], và có thể khái quát như là: A module should be responsible to one, and only one, actor. Một module phần mềm chỉ nên phục vụ 1 và chỉ 1 đối tượng sử dụng.","image":"/https://wanted2.github.io/assets/images/srp-and-ccp.jpeg","headline":"Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất","dateModified":"2021-08-07T00:00:00+09:00","datePublished":"2021-08-07T00:00:00+09:00","url":"/https://wanted2.github.io/srp-ccp/","author":{"@type":"Person","name":"tuan"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/https://wanted2.github.io/assets/images/favicon.ico"},"name":"tuan"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="https://wanted2.github.io/assets/css/screen.css" rel="stylesheet">

<link href="https://wanted2.github.io/assets/css/main.css" rel="stylesheet">

<script src="https://wanted2.github.io/assets/js/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/d0b91d895e.js" crossorigin="anonymous"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
    }
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript" crossorigin="anonymous"></script>
<script src="https://d3js.org/d3.v4.js" crossorigin="anonymous"></script>
<!-- <script src="https://bl.ocks.org/mbostock/raw/4061502/0a200ddf998aa75dfdb1ff32e16b680a15e5cb01/box.js" crossorigin="anonymous"></script> -->
</head>


<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="https://wanted2.github.io/">
    <img src="https://wanted2.github.io/assets/images/favicon.ico" alt="AiFi">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="https://wanted2.github.io/">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="https://wanted2.github.io/about">About</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="https://wanted2.github.io/projects">Projects</a>
                </li>

                <!-- <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://bootstrapstarter.com/bootstrap-templates/template-mediumish-bootstrap-jekyll/"> Docs</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/wowthemesnet/mediumish-theme-jekyll"><i class="fab fa-github"></i> Fork on Github</a>
                </li> -->

                <!-- <script src="https://wanted2.github.io/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="https://wanted2.github.io/assets/js/lunrsearchengine.js"></script> -->

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">AiFi</h1>
    <p class="lead">
        An AI Engineer's blog
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất&url=https://wanted2.github.io/srp-ccp/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=https://wanted2.github.io/srp-ccp/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://wanted2.github.io/srp-ccp/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="mailto:?subject=Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất&body=https://wanted2.github.io/srp-ccp/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fas fa-envelope"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-2 col-lg-2 text-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="https://wanted2.github.io/assets/images/favicon.png" alt="AiFi">
                        
                    </div>
                    <div class="col-xs-12 col-md-10 col-lg-10 text-right">
                        <a target="_blank" class="link-dark" href="">AiFi</a>
                        <!-- <a target="_blank" href="" class="btn follow">Follow</a> -->
                        <!-- LikeBtn.com BEGIN -->
                        <span class="likebtn-wrapper" 
                            data-site_id=""
                            data-theme="custom" 
                            data-icon_l_url="/assets/images/OK_EM.png" 
                            data-icon_l_url_v="/assets/images/OK_EM_clicked.png" 
                            data-identifier="/srp-ccp/" 
                            data-show_like_label="false" 
                            data-like_enabled="false" 
                            data-dislike_enabled="false" 
                            data-icon_dislike_show="false" 
                            data-voting_cancelable="false" 
                            data-counter_show="true"
                            data-counter_frmt="comma"></span>
                        <script>(function(d,e,s){if(d.getElementById("likebtn_wjs"))return;a=d.createElement(e);m=d.getElementsByTagName(e)[0];a.async=1;a.id="likebtn_wjs";a.src=s;m.parentNode.insertBefore(a, m)})(document,"script","//w.likebtn.com/js/w/widget.js");</script>
                        <!-- LikeBtn.com END -->
                        <span class="author-description"></span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="https://wanted2.github.io/assets/images/srp-and-ccp.jpeg" alt="Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                    
                    <div class="toc mt-4 mb-4 lead">
                        <h3 class="font-weight-bold">Summary</h3>
                        <ul>
  <li><a href="#giới-thiệu">Giới thiệu</a></li>
  <li><a href="#quy-tắc-trách-nhiệm-đơn-single-responsibility-principle">Quy tắc trách nhiệm đơn (Single Responsibility Principle)</a>
    <ul>
      <li><a href="#ví-dụ-đời-sống-hồ-sơ-xin-việc">Ví dụ đời sống: hồ sơ xin việc</a></li>
      <li><a href="#ví-dụ-code-php-thiết-kế-streamers">Ví dụ code PHP: thiết kế streamers</a></li>
    </ul>
  </li>
  <li><a href="#quy-tắc-thuần-nhất-common-closure-principle">Quy tắc thuần nhất (Common Closure Principle)</a>
    <ul>
      <li><a href="#ví-dụ-đời-sống-chung-và-riêng">Ví dụ đời sống: Chung và Riêng</a></li>
      <li><a href="#ví-dụ-kỹ-thuật-tại-sao-phải-phân-chia-backendfrontend-serverclient">Ví dụ kỹ thuật: Tại sao phải phân chia backend/frontend, server/client?</a></li>
    </ul>
  </li>
  <li><a href="#kết-luận">Kết luận</a></li>
  <li><a href="#tài-liệu-tham-khảo">Tài liệu tham khảo</a></li>
</ul>
                    </div>
                
                <!-- End Toc -->
                <p>Quy tắc <strong>trách nhiệm đơn</strong> (SRP, [2]) là nguyên tắc đầu tiên trong SOLID [2], và có thể khái quát như là:</p>

<blockquote>
  <p>A module should be responsible to one, and only one, actor.
Một module phần mềm chỉ nên phục vụ 1 và chỉ 1 đối tượng sử dụng.</p>
</blockquote>

<!--more-->

<h1 id="giới-thiệu">Giới thiệu</h1>

<p>Quy tắc <strong>trách nhiệm đơn</strong> (SRP, [2]) là nguyên tắc đầu tiên trong SOLID [2], và có thể khái quát như là:</p>

<blockquote>
  <p>A module should be responsible to one, and only one, actor.
Một module phần mềm chỉ nên phục vụ 1 và chỉ 1 đối tượng sử dụng.</p>
</blockquote>

<p><img src="/assets/images/srp.svg" style="width: 40%; float:left; margin:20pt;" />
Hình vẽ bên thể hiện design một class <code class="language-plaintext highlighter-rouge">Employee</code> vi phạm SRP: nó phục vụ cùng lúc 4 đối tượng khác nhau là quản lý dự án (PM), kỹ sư cầu nối (BrSE), backend dev và frontend dev.
PM có thể cần dùng <code class="language-plaintext highlighter-rouge">manageAttendance()</code> để quản lý hoạt động của team.
BrSE có thể cần <code class="language-plaintext highlighter-rouge">callClient()</code> để liên lạc khách hàng.
Backend dev có thể cần <code class="language-plaintext highlighter-rouge">accessServer()</code> để làm việc.
Và frontend dev có thể cần <code class="language-plaintext highlighter-rouge">getToken()</code> từ backend để xác nhận người dùng.
<strong>Tuy nhiên, để tất cả trong cùng 1 rọ <code class="language-plaintext highlighter-rouge">Employee</code> như vậy có vấn đề gì?</strong>.
Backend dev có thể chặn các kết nối với bên ngoài để hạn chế việc sử dụng <code class="language-plaintext highlighter-rouge">accessServer()</code>, nhưng việc này lại khiến BrSE khó làm việc khi mỗi lần <code class="language-plaintext highlighter-rouge">callClient()</code> lại phải qua hàng loạt thủ tục xác nhận.
Khi 1 nhân vật yêu cầu một thay đổi gì đó trong class Employee thì lại ảnh hưởng tới các nhân vật khác!
Một lời giải cho vấn đề này là sử dụng <em>Facade</em> pattern mà ta sẽ giải thích sau.</p>

<p>Nếu như quy tắc SRP quan tâm tới cách phân bổ các hàm trong class thì quy tắc <strong>thuần nhất</strong> (Component Cohesion Principle, CCP) lại quan tâm tới việc phân bổ các class và module phần mềm vào các thành phần phần mềm (software component).
Có 3 quy tắc chính trong nhóm nguyên tắc này là:</p>
<ul>
  <li><strong>REP</strong>: The Reuse/Release Equivalence Principle</li>
  <li><strong>CCP</strong>: The Common Closure Principle</li>
  <li><strong>CRP</strong>: The Common Reuse Principle</li>
</ul>

<p>Chúng ta sẽ quan tâm tới CCP.
Nội dung quy tắc nói như sau:</p>

<blockquote>
  <p>Gather into components those classes that change for the same reasons and at the same times. Separate into different components those classes that change at different times and for different reasons.</p>
</blockquote>

<blockquote>
  <p>Tập hợp vào cùng component những class thay đổi cùng lúc và cùng lý do. Tách các class thay đổi không cùng lúc và vì lý do khác nhau thành những component khác nhau.</p>
</blockquote>

<p>Nhìn chung, nguyên tắc CCP khá gần với SRP nhưng ở cấp độ cao hơn. Cả 2 quy tắc đều yêu cầu sự <strong>đồng bộ</strong> cần thiết khi lựa chọn các phần tử vào một module hay component phần mềm.</p>

<h1 id="quy-tắc-trách-nhiệm-đơn-single-responsibility-principle">Quy tắc trách nhiệm đơn (Single Responsibility Principle)</h1>

<h2 id="ví-dụ-đời-sống-hồ-sơ-xin-việc">Ví dụ đời sống: hồ sơ xin việc</h2>

<p>Cách đây cũng khá lâu, tôi có anh bạn đi phỏng vấn một công ty phần mềm và có vẻ khả quan, nhưng không hiểu sao lúc nhận kết quả lại là <strong>“hoặc ý thức kém, hoặc code kém”</strong>.
Bạn tôi cũng không hiểu nổi phải nhìn nhận kết quả này kiểu gì?
Tức là người phỏng vấn đánh giá là 1 trong hai khả năng “ý thức kém”, hoặc “code kém”, chứ không nói là cả hai.
Đồng thời, bạn tôi cũng kể lại là lúc phỏng vấn chỉ nói mấy chuyện xung quanh hồ sơ, và chuyện phiếm chứ cũng không bị yêu cầu code hay gì khác.
Vậy căn cứ vào đâu mà người phỏng vấn lại kết luận như vậy dù không nhìn một dòng code nào của bạn tôi?</p>

<p>Cũng là tình cờ, một thời gian sau, tôi lại có dịp làm việc cùng với chính đội phỏng vấn ấy.
Thì một trong những yêu cầu quan trọng của họ là năng lực thiết kế và kỹ năng phát triển phần mềm tốt.
Trong bộ câu hỏi của họ có một câu hỏi là <code class="language-plaintext highlighter-rouge">Kiểm tra thói quen thiết kế, mindset về thiết kế của ứng viên</code>.
Bạn tôi cũng thú thực là có bị hỏi về cách thức sắp xếp các trọng trách của mình và giải thích tại sao lại sắp xếp như vậy.</p>

<p>Tất nhiên là cũng có thể chưa có nhiều kinh nghiệm nên sự sắp xếp có thể khiến cho người phỏng vấn cảm thấy hơi bối rối.
Cũng như ví dụ về <code class="language-plaintext highlighter-rouge">Employee</code> ở trên, nếu bạn không giải thích rõ được tại sao lại gộp hết trách nhiệm vào cùng 1 class, và điều đó thể hiện trong lối sống thì chứng tỏ bạn chưa thấm nhuần tư tưởng của SOLID.
Nếu vậy thì tại sao? Một là chưa biết cách code theo SOLID thì bị đánh giá là code kém.
Hai là biết rồi nhưng không chịu áp dụng, thì lại thành ý thức kém.</p>

<p>Một lĩnh vực tuy mới nhưng vẫn đứng vững và đang trở nên thành ngành phổ biến trên thế giới như phần mềm thì đương nhiên bên trong nó có nội lực rất mạnh.
Nội lực đó thể hiện qua thể chế cực kỳ cứng (SOLID), quy trình, triết lý cũng chuẩn chỉnh … chứ không phải là một mớ ô hợp, tùy tiện.
Vì vậy, đứng trước những người lâu năm trong ngành như vậy, nếu không thể hiện được những tiêu chí cơ bản nhất thì chỉ có bị đánh giá là “hoặc ý thức kém, hoặc code kém” (hoặc cả hai).</p>

<h2 id="ví-dụ-code-php-thiết-kế-streamers">Ví dụ code PHP: thiết kế streamers</h2>

<p>Trong các framework về lập trình web bằng ngôn ngữ lập trình PHP thì Laravel có lẽ là một ngôn ngữ sở hữu bộ design pattern được implement phong phú nhất.
Điều này khiến lập trình viên Laravel nhanh chóng tiếp cận con đường “chính đạo”, tránh việc dòng đời xô đẩy đi theo tà đạo.
Vì thế việc đầu tiên khi bắt đầu với Laravel là tìm hiểu bộ pattern được implement trong framework như Command, Observer/Listener, Factories, Facade, …
Nói không ngoa thì sở hữu kỹ năng Laravel cũng như bằng chứng rằng đã có tiếp cận các quy tắc thiết kế phần mềm.</p>

<p>Hôm nay chúng ta sẽ lấy ví dụ về sử dụng <a href="https://refactoring.guru/design-patterns/facade">pattern Facade</a> để xây dựng Streamer service bằng Laravel.
Một điểm chú ý là bản thân Laravel cũng có một feature tên là <a href="https://laravel.com/docs/8.x/facades#introduction">Facade</a>.
Pattern Facade mà ta nói tới hôm nay cũng na ná như vậy khi cung cấp một interface để ẩn hoạt động của các subsytems đằng sau.
Ở đây chúng ta sẽ tham khảo một chút code của dự án <a href="https://github.com/koel/koel">koel</a>, một ứng dụng streaming nhạc cá nhân.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">use</span> <span class="nc">App\Services\Streamers\DirectStreamerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Services\Streamers\ObjectStorageStreamerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Services\Streamers\StreamerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Services\Streamers\TranscodingStreamerInterface</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Giả sử ta muốn tạo ra 3 streamers cho 3 phương án streaming khác nhau:</p>

<ul>
  <li>Streaming trực tiếp từ file, gọi là <code class="language-plaintext highlighter-rouge">DirectStreamerInterface</code>.</li>
  <li>Streaming từ Amazon S3 file, gọi là <code class="language-plaintext highlighter-rouge">ObjectStorageStreamerInterface</code>.</li>
  <li>Streaming với transcoding trước khi streaming từ file, gọi là <code class="language-plaintext highlighter-rouge">TranscodingStreamerInterface</code>.</li>
  <li>Cả 3 interfaces trên đều extend từ <code class="language-plaintext highlighter-rouge">StreamerInterface</code>. Cả 3 đều implement interface method là <code class="language-plaintext highlighter-rouge">setSong()</code> và <code class="language-plaintext highlighter-rouge">stream()</code>, nhưng <code class="language-plaintext highlighter-rouge">TranscodingStreamerInterface</code> sẽ cần thêm <code class="language-plaintext highlighter-rouge">setBitrate()</code> và <code class="language-plaintext highlighter-rouge">setStartTime()</code>.</li>
</ul>

<p>Khi sử dụng, có 1 logic lựa chọn streamer như sau:</p>

<ul>
  <li>Nếu thông số của S3 được set thì sẽ chọn <code class="language-plaintext highlighter-rouge">ObjectStorageStreamerInterface</code>;</li>
  <li>Nếu không, thì xem tiếp có cần transcoding không? Nếu có thì set bitrate và start time, rồi chọn <code class="language-plaintext highlighter-rouge">TranscodingStreamerInterface</code></li>
  <li>Nếu không cần transcoding thì chọn <code class="language-plaintext highlighter-rouge">DirectStreamerInterface</code>.</li>
</ul>

<p>Một logic bao gồm 3 subsystems khác nhau như vậy sẽ rất phức tạp nếu để người dùng can thiệp trực tiếp vào.
Vì vậy, đơn giản nhất là tạo một interface hầu như không chứa code là <code class="language-plaintext highlighter-rouge">StreamerInterface</code> để chạy hàm <code class="language-plaintext highlighter-rouge">stream()</code>.
Chúng ta có thể dùng thêm Factory pattern để ẩn quy trình chọn này đi như sau:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">StreamerFactory</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">DirectStreamerInterface</span> <span class="nv">$directStreamer</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">TranscodingStreamerInterface</span> <span class="nv">$transcodingStreamer</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">ObjectStorageStreamerInterface</span> <span class="nv">$objectStorageStreamer</span><span class="p">;</span>
    
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">createStreamer</span><span class="p">(</span>
        <span class="kt">Song</span> <span class="nv">$song</span><span class="p">,</span>
        <span class="kt">?bool</span> <span class="nv">$transcode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="kt">?int</span> <span class="nv">$bitRate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="kt">float</span> <span class="nv">$startTime</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="p">):</span> <span class="kt">StreamerInterface</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$song</span><span class="o">-&gt;</span><span class="n">s3_params</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">objectStorageStreamer</span><span class="o">-&gt;</span><span class="nf">setSong</span><span class="p">(</span><span class="nv">$song</span><span class="p">);</span>

            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">objectStorageStreamer</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$transcode</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingService</span><span class="o">-&gt;</span><span class="nf">songShouldBeTranscoded</span><span class="p">(</span><span class="nv">$song</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$transcode</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$transcode</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingStreamer</span><span class="o">-&gt;</span><span class="nf">setSong</span><span class="p">(</span><span class="nv">$song</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingStreamer</span><span class="o">-&gt;</span><span class="nf">setBitRate</span><span class="p">(</span><span class="nv">$bitRate</span> <span class="o">?:</span> <span class="nf">config</span><span class="p">(</span><span class="s1">'koel.streaming.bitrate'</span><span class="p">));</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingStreamer</span><span class="o">-&gt;</span><span class="nf">setStartTime</span><span class="p">(</span><span class="nv">$startTime</span><span class="p">);</span>

            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingStreamer</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">directStreamer</span><span class="o">-&gt;</span><span class="nf">setSong</span><span class="p">(</span><span class="nv">$song</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">directStreamer</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Khi sử dụng, chúng ta chỉ cần quan tâm tới <code class="language-plaintext highlighter-rouge">StreamerInterface-&gt;stream()</code> mà không cần quan tâm tới những xử lý chi tiết bên dưới.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">PlayController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">StreamerFactory</span> <span class="nv">$streamerFactory</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">StreamerFactory</span> <span class="nv">$streamerFactory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">streamerFactory</span> <span class="o">=</span> <span class="nv">$streamerFactory</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">show</span><span class="p">(</span><span class="kt">SongPlayRequest</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Song</span> <span class="nv">$song</span><span class="p">,</span> <span class="kt">?bool</span> <span class="nv">$transcode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="kt">?int</span> <span class="nv">$bitRate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">streamerFactory</span>
            <span class="o">-&gt;</span><span class="nf">createStreamer</span><span class="p">(</span><span class="nv">$song</span><span class="p">,</span> <span class="nv">$transcode</span><span class="p">,</span> <span class="nv">$bitRate</span><span class="p">,</span> <span class="nb">floatval</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="nf">stream</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Thiết kế trên giảm độ phức tạp hệ thống mà khiến cho mỗi streamer chỉ cần quan tâm đến các hàm mà mình cần, không phải chung với các streamer khác.</p>

<h1 id="quy-tắc-thuần-nhất-common-closure-principle">Quy tắc thuần nhất (Common Closure Principle)</h1>

<h2 id="ví-dụ-đời-sống-chung-và-riêng">Ví dụ đời sống: Chung và Riêng</h2>

<p>Trong đời sống có khá nhiều ví dụ về CCP.
Một team làm việc có cả kế toán, nhân sự, lập trình viên, quản lý, …
Vậy <strong>lịch họp sẽ trở thành thế nào?</strong>
Một đội quân ô hợp như vậy thì nếu họp chung thì sẽ mỗi người một ý.
Bây giờ giả sử bạn yêu cầu tất cả bỏ phiếu chọn ra 1 ngày để họp thì sẽ thấy ngay:
những người quản lý thường sẽ chọn đầu hoặc cuối tuần làm việc để tiện cho nắm bắt cả team.
Nhưng những người làm sales thì lại hay phải ra ngoài, họ sẽ bị phụ thuộc vào khách.
Lập trình viên thì lại bị chi phối bởi deadline giao hàng.
Kết cục, là chuyện không thể tìm được 1 ngày khiến tất cả vui vẻ.
Ngoài ra khi đã chọn được một ngày chung, thì sẽ rất khó với vấn đề thay đổi: nhân viên bán hàng có thể thay đổi theo lịch của khách mà quản lý và lập trình viên hầu như không thay đổi.
Như vậy, bạn sẽ phải đối ứng với gấp 3 lần sự thay đổi nếu chỉ lên lịch cho 1 team chỉ toàn lập trình viên đang chạy theo 1 dự án cùng nhau.</p>

<p><strong>Chung</strong> là tốt nhưng phải là chung với những người <strong>giống mình</strong> về thời điểm thay đổi và lý do thay đổi!
Còn nếu không thì phải tách <strong>riêng</strong> những người <strong>khác mình</strong> ra.</p>

<p>Common Closure Principle là quy tắc khép kín thành phần phần mềm chỉ bao gồm những class hay module phần mềm giống nhau về thời điểm cũng như lý do thay đổi.
Một nguyên tắc trong các dự án phần mềm là <strong>bảo trì bao giờ cũng quan trọng hơn tái sử dụng</strong>.
Để cho việc bảo trì và vận hành trở nên dễ dàng, thiết kế các thành phần theo CCP là việc cần làm.</p>

<h2 id="ví-dụ-kỹ-thuật-tại-sao-phải-phân-chia-backendfrontend-serverclient">Ví dụ kỹ thuật: Tại sao phải phân chia backend/frontend, server/client?</h2>

<p>Kiến trúc server/client, hay gần đây đôi khi biến hình thành kiểu backend/frontend cũng không còn xa lạ.
Nhìn chung, sẽ có hai nhóm xử lý quan trọng trong dự án phần mềm web: một là những xử lý đặt tại server (hoặc gần đây là serverless, auto-scaling clusters), và một là những xử lý cho client đặt tại thiết bị người dùng (PC, mobile, tablets, …).
Theo quy tắc CCP và SRP, chuyện tách riêng hai nhóm này ra là chuyện nên làm.
Và trong thực tế, kể cả trên thị trường tuyển dụng, việc tuyển người riêng cho từng thành phần backend và frontend cũng là xu hướng thường thấy, và bị chi phối bởi luật CCP/SRP.</p>

<h1 id="kết-luận">Kết luận</h1>

<p>Hai quy tắc mà chúng ta thảo luận ngày hôm nay là khá cơ bản với mọi kỹ sư phần mềm bài bản.
Chúng ta có thể nhìn thấy những điểm sau từ SRP và CCP:</p>

<ul>
  <li>Bảo trì luôn quan trọng hơn tái sử dụng, đặc biệt là khi vận hành.</li>
  <li>Nên xếp những thứ giống nhau vào cùng một rọ, chứ đừng tạo ra những cái rọ ô hợp trong phần mềm.</li>
  <li>Facade là một thói quen cho lập trình viên hoặc thiết kế phần mềm khi đối đầu với một dự án phần mềm phức tạp.</li>
</ul>

<h1 id="tài-liệu-tham-khảo">Tài liệu tham khảo</h1>

<ol class="bibliography"><li><span id="HumbleOb26:online"><i>Humble Object at XUnitPatterns.com</i>. http://xunitpatterns.com/Humble%20Object.html.</span></li>
<li><span id="cleanarch">Martin, R. C. (2017). <i>Clean Architecture - A Craftman’s Guide to Software Structure and Design</i>. Prentice Hall.</span></li>
<li><span id="martin2009clean">Martin, R. C. (2009). <i>Clean code: a handbook of agile software craftsmanship</i>. Pearson Education.</span></li>
<li><span id="martin2007professionalism">Martin, R. C. (2007). Professionalism and test-driven development. <i>IEEE Software</i>, <i>24</i>(3), 32–36.</span></li>
<li><span id="binder2000testing">Binder, R. (2000). <i>Testing object-oriented systems: models, patterns, and tools</i>. Addison-Wesley Professional.</span></li>
<li><span id="abstraction1988hierarchy">Liskov, B. (1988). Data Abstraction and Hierarchy. <i>SIGPLAN Notices</i>, <i>23</i>(5), 17–34.</span></li></ol>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2021-08-07">07 Aug 2021</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/categories#Site-Reliable-Engineering">Site Reliable Engineering</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/categories#Software-Engineering">Software Engineering</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/categories#Tiếng-Việt,-日本語">Tiếng Việt, 日本語</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/tags#SOLID">#SOLID</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/tags#common-closure-principle">#common closure principle</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/tags#component-cohesion">#component cohesion</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/tags#devops">#devops</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/tags#programming">#programming</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/tags#single-responsibility-principle">#single responsibility principle</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/tags#site-reliability-engineering">#site reliability engineering</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="https://wanted2.github.io/tags#software-architecture">#software architecture</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="https://wanted2.github.io//the-dip/"> &laquo; The Abstract Factory</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="https://wanted2.github.io//unit-tests-clean/">Professionalism and Test-Driven Development - Sự chuyên nghiệp và kiểm nghiệm định hướng phát triển &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'caineng'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


<!-- Bottom Alert Bar
================================================== -->
<div class="alertbar">
	<div class="container text-center">
		<span><img src="https://wanted2.github.io/assets/images/favicon.ico" alt="AiFi" style="max-height: 48px;" /> &nbsp; Never miss a <b>story</b> from us, subscribe to our newsletter</span>
        <form action="https://caineng.us20.list-manage.com/subscribe/post?u=76342d3d74a6807aac5aec0d7&id=b5645e19be" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate>
            <div class="mc-field-group">
            <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required>
            <input type="submit" value="Subscribe" name="subscribe" class="heart">
            </div>
        </form>
	</div>
</div>

    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="https://wanted2.github.io/categories#Site-Reliable-Engineering">Site Reliable Engineering (15)</a>
                
                    <a class="mt-1 mb-1" href="https://wanted2.github.io/categories#Software-Engineering">Software Engineering (36)</a>
                
                    <a class="mt-1 mb-1" href="https://wanted2.github.io/categories#Computer-Vision">Computer Vision (5)</a>
                
                    <a class="mt-1 mb-1" href="https://wanted2.github.io/categories#Artificial-Intelligence">Artificial Intelligence (16)</a>
                
                    <a class="mt-1 mb-1" href="https://wanted2.github.io/categories#Tiếng-Việt,-日本語">Tiếng Việt, 日本語 (35)</a>
                
                    <a class="mt-1 mb-1" href="https://wanted2.github.io/categories#Project-Management">Project Management (34)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2022 AiFi 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="https://wanted2.github.io/assets/js/mediumish.js"></script>


<script src="https://wanted2.github.io/assets/js/lazyload.js"></script>


<script src="https://wanted2.github.io/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//caineng.disqus.com/count.js"></script>


</body>
</html>
