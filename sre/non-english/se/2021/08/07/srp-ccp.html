<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="https://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1"
  />

  <title>
     Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất &middot; AiFi 
  </title>

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2CDTCF0EP6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-2CDTCF0EP6');
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link
    rel="alternate"
    type="application/rss+xml"
    title="RSS"
    href="/feed.xml"
  />

  <!-- Additional head bits without overriding original head -->
  <style>
    div.chart {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
    .line {
  fill: none;
  stroke: steelblue;
  stroke-width: 2px;
}

.grid line {
  stroke: lightgrey;
  stroke-opacity: 0.7;
  shape-rendering: crispEdges;
}

.grid path {
  stroke-width: 0;
}
  </style>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="http://bl.ocks.org/mbostock/raw/4061502/0a200ddf998aa75dfdb1ff32e16b680a15e5cb01/box.js"></script>
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        AiFi
      </a>
    </div>
    <p class="lead">The official AiFi</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
      <a class="page-link "
          href="/projects.html">Projects and Demos</a>
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  


  
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/ai.html">Artificial Intelligence</a>
    
  

  
    
      <a class="category-link "
          href="/category/cv.html">Computer Vision</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/non-english.html">Tiếng Việt, 日本語</a>
    
  

  
    
      <a class="category-link "
          href="/category/pm.html">Project Management</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/se.html">Software Engineering</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/sre.html">Site Reliability Engineering</a>
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>

  <a href="/about.html">About</a>

  

  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p>
  &copy; 2021.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">07 Aug 2021</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/sre.html">
          Site Reliability Engineering
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/non-english.html">
          Tiếng Việt, 日本語
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/se.html">
          Software Engineering
        </a>
      
    
  </span>
  <span class="share-page">
    &bull;
    <a href="https://linkedin.com/shareArticle?url=https://wanted2.github.io/sre/non-english/se/2021/08/07/srp-ccp.html" target="_blank"><i class="fa fa-linkedin"></i></a>
    <a href="https://twitter.com/intent/tweet?text=Luận bàn về nguyên tắc trách nhiệm đơn và tính thuần nhất&url=https://wanted2.github.io/sre/non-english/se/2021/08/07/srp-ccp.html&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fab fa-twitter"></i></a>
    <a href="https://facebook.com/sharer.php?u=https://wanted2.github.io/sre/non-english/se/2021/08/07/srp-ccp.html" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a>
</span>

<span title="Estimated read time">
  
  
    13 mins
  
</span>

</div>

  <div id="table-of-contents">
  <h2>Index</h2>
    <ol id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#giới-thiệu">Giới thiệu</a></li>
<li class="toc-entry toc-h1"><a href="#quy-tắc-trách-nhiệm-đơn-single-responsibility-principle">Quy tắc trách nhiệm đơn (Single Responsibility Principle)</a>
<ol>
<li class="toc-entry toc-h2"><a href="#ví-dụ-đời-sống-hồ-sơ-xin-việc">Ví dụ đời sống: hồ sơ xin việc</a></li>
<li class="toc-entry toc-h2"><a href="#ví-dụ-code-php-thiết-kế-streamers">Ví dụ code PHP: thiết kế streamers</a></li>
</ol>
</li>
<li class="toc-entry toc-h1"><a href="#quy-tắc-thuần-nhất-common-closure-principle">Quy tắc thuần nhất (Common Closure Principle)</a>
<ol>
<li class="toc-entry toc-h2"><a href="#ví-dụ-đời-sống-chung-và-riêng">Ví dụ đời sống: Chung và Riêng</a></li>
<li class="toc-entry toc-h2"><a href="#ví-dụ-kỹ-thuật-tại-sao-phải-phân-chia-backendfrontend-serverclient">Ví dụ kỹ thuật: Tại sao phải phân chia backend/frontend, server/client?</a></li>
</ol>
</li>
<li class="toc-entry toc-h1"><a href="#kết-luận">Kết luận</a></li>
<li class="toc-entry toc-h1"><a href="#tài-liệu-tham-khảo">Tài liệu tham khảo</a></li>
</ol>
  </div>

  <div class="post-body">
    <p><img src="/assets/img/srp-and-ccp.jpeg" alt="" /></p>

<!--more-->

<h1 id="giới-thiệu">Giới thiệu</h1>

<p>Quy tắc <strong>trách nhiệm đơn</strong> (SRP, [2]) là nguyên tắc đầu tiên trong SOLID [2], và có thể khái quát như là:</p>

<blockquote>
  <p>A module should be responsible to one, and only one, actor.
Một module phần mềm chỉ nên phục vụ 1 và chỉ 1 đối tượng sử dụng.</p>
</blockquote>

<p><img src="/assets/img/srp.svg" style="width: 40%; float:left; margin:20pt;" />
Hình vẽ bên thể hiện design một class <code class="language-plaintext highlighter-rouge">Employee</code> vi phạm SRP: nó phục vụ cùng lúc 4 đối tượng khác nhau là quản lý dự án (PM), kỹ sư cầu nối (BrSE), backend dev và frontend dev.
PM có thể cần dùng <code class="language-plaintext highlighter-rouge">manageAttendance()</code> để quản lý hoạt động của team.
BrSE có thể cần <code class="language-plaintext highlighter-rouge">callClient()</code> để liên lạc khách hàng.
Backend dev có thể cần <code class="language-plaintext highlighter-rouge">accessServer()</code> để làm việc.
Và frontend dev có thể cần <code class="language-plaintext highlighter-rouge">getToken()</code> từ backend để xác nhận người dùng.
<strong>Tuy nhiên, để tất cả trong cùng 1 rọ <code class="language-plaintext highlighter-rouge">Employee</code> như vậy có vấn đề gì?</strong>.
Backend dev có thể chặn các kết nối với bên ngoài để hạn chế việc sử dụng <code class="language-plaintext highlighter-rouge">accessServer()</code>, nhưng việc này lại khiến BrSE khó làm việc khi mỗi lần <code class="language-plaintext highlighter-rouge">callClient()</code> lại phải qua hàng loạt thủ tục xác nhận.
Khi 1 nhân vật yêu cầu một thay đổi gì đó trong class Employee thì lại ảnh hưởng tới các nhân vật khác!
Một lời giải cho vấn đề này là sử dụng <em>Facade</em> pattern mà ta sẽ giải thích sau.</p>

<p>Nếu như quy tắc SRP quan tâm tới cách phân bổ các hàm trong class thì quy tắc <strong>thuần nhất</strong> (Component Cohesion Principle, CCP) lại quan tâm tới việc phân bổ các class và module phần mềm vào các thành phần phần mềm (software component).
Có 3 quy tắc chính trong nhóm nguyên tắc này là:</p>
<ul>
  <li><strong>REP</strong>: The Reuse/Release Equivalence Principle</li>
  <li><strong>CCP</strong>: The Common Closure Principle</li>
  <li><strong>CRP</strong>: The Common Reuse Principle</li>
</ul>

<p>Chúng ta sẽ quan tâm tới CCP.
Nội dung quy tắc nói như sau:</p>

<blockquote>
  <p>Gather into components those classes that change for the same reasons and at the same times. Separate into different components those classes that change at different times and for different reasons.</p>
</blockquote>

<blockquote>
  <p>Tập hợp vào cùng component những class thay đổi cùng lúc và cùng lý do. Tách các class thay đổi không cùng lúc và vì lý do khác nhau thành những component khác nhau.</p>
</blockquote>

<p>Nhìn chung, nguyên tắc CCP khá gần với SRP nhưng ở cấp độ cao hơn. Cả 2 quy tắc đều yêu cầu sự <strong>đồng bộ</strong> cần thiết khi lựa chọn các phần tử vào một module hay component phần mềm.</p>

<h1 id="quy-tắc-trách-nhiệm-đơn-single-responsibility-principle">Quy tắc trách nhiệm đơn (Single Responsibility Principle)</h1>

<h2 id="ví-dụ-đời-sống-hồ-sơ-xin-việc">Ví dụ đời sống: hồ sơ xin việc</h2>

<p>Cách đây cũng khá lâu, tôi có anh bạn đi phỏng vấn một công ty phần mềm và có vẻ khả quan, nhưng không hiểu sao lúc nhận kết quả lại là <strong>“hoặc ý thức kém, hoặc code kém”</strong>.
Bạn tôi cũng không hiểu nổi phải nhìn nhận kết quả này kiểu gì?
Tức là người phỏng vấn đánh giá là 1 trong hai khả năng “ý thức kém”, hoặc “code kém”, chứ không nói là cả hai.
Đồng thời, bạn tôi cũng kể lại là lúc phỏng vấn chỉ nói mấy chuyện xung quanh hồ sơ, và chuyện phiếm chứ cũng không bị yêu cầu code hay gì khác.
Vậy căn cứ vào đâu mà người phỏng vấn lại kết luận như vậy dù không nhìn một dòng code nào của bạn tôi?</p>

<p>Cũng là tình cờ, một thời gian sau, tôi lại có dịp làm việc cùng với chính đội phỏng vấn ấy.
Thì một trong những yêu cầu quan trọng của họ là năng lực thiết kế và kỹ năng phát triển phần mềm tốt.
Trong bộ câu hỏi của họ có một câu hỏi là <code class="language-plaintext highlighter-rouge">Kiểm tra thói quen thiết kế, mindset về thiết kế của ứng viên</code>.
Bạn tôi cũng thú thực là có bị hỏi về cách thức sắp xếp các trọng trách của mình và giải thích tại sao lại sắp xếp như vậy.</p>

<p>Tất nhiên là cũng có thể chưa có nhiều kinh nghiệm nên sự sắp xếp có thể khiến cho người phỏng vấn cảm thấy hơi bối rối.
Cũng như ví dụ về <code class="language-plaintext highlighter-rouge">Employee</code> ở trên, nếu bạn không giải thích rõ được tại sao lại gộp hết trách nhiệm vào cùng 1 class, và điều đó thể hiện trong lối sống thì chứng tỏ bạn chưa thấm nhuần tư tưởng của SOLID.
Nếu vậy thì tại sao? Một là chưa biết cách code theo SOLID thì bị đánh giá là code kém.
Hai là biết rồi nhưng không chịu áp dụng, thì lại thành ý thức kém.</p>

<p>Một lĩnh vực tuy mới nhưng vẫn đứng vững và đang trở nên thành ngành phổ biến trên thế giới như phần mềm thì đương nhiên bên trong nó có nội lực rất mạnh.
Nội lực đó thể hiện qua thể chế cực kỳ cứng (SOLID), quy trình, triết lý cũng chuẩn chỉnh … chứ không phải là một mớ ô hợp, tùy tiện.
Vì vậy, đứng trước những người lâu năm trong ngành như vậy, nếu không thể hiện được những tiêu chí cơ bản nhất thì chỉ có bị đánh giá là “hoặc ý thức kém, hoặc code kém” (hoặc cả hai).</p>

<h2 id="ví-dụ-code-php-thiết-kế-streamers">Ví dụ code PHP: thiết kế streamers</h2>

<p>Trong các framework về lập trình web bằng ngôn ngữ lập trình PHP thì Laravel có lẽ là một ngôn ngữ sở hữu bộ design pattern được implement phong phú nhất.
Điều này khiến lập trình viên Laravel nhanh chóng tiếp cận con đường “chính đạo”, tránh việc dòng đời xô đẩy đi theo tà đạo.
Vì thế việc đầu tiên khi bắt đầu với Laravel là tìm hiểu bộ pattern được implement trong framework như Command, Observer/Listener, Factories, Facade, …
Nói không ngoa thì sở hữu kỹ năng Laravel cũng như bằng chứng rằng đã có tiếp cận các quy tắc thiết kế phần mềm.</p>

<p>Hôm nay chúng ta sẽ lấy ví dụ về sử dụng <a href="https://refactoring.guru/design-patterns/facade">pattern Facade</a> để xây dựng Streamer service bằng Laravel.
Một điểm chú ý là bản thân Laravel cũng có một feature tên là <a href="https://laravel.com/docs/8.x/facades#introduction">Facade</a>.
Pattern Facade mà ta nói tới hôm nay cũng na ná như vậy khi cung cấp một interface để ẩn hoạt động của các subsytems đằng sau.
Ở đây chúng ta sẽ tham khảo một chút code của dự án <a href="https://github.com/koel/koel">koel</a>, một ứng dụng streaming nhạc cá nhân.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">App\Services\Streamers\DirectStreamerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Services\Streamers\ObjectStorageStreamerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Services\Streamers\StreamerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Services\Streamers\TranscodingStreamerInterface</span><span class="p">;</span>
</code></pre></div></div>

<p>Giả sử ta muốn tạo ra 3 streamers cho 3 phương án streaming khác nhau:</p>

<ul>
  <li>Streaming trực tiếp từ file, gọi là <code class="language-plaintext highlighter-rouge">DirectStreamerInterface</code>.</li>
  <li>Streaming từ Amazon S3 file, gọi là <code class="language-plaintext highlighter-rouge">ObjectStorageStreamerInterface</code>.</li>
  <li>Streaming với transcoding trước khi streaming từ file, gọi là <code class="language-plaintext highlighter-rouge">TranscodingStreamerInterface</code>.</li>
  <li>Cả 3 interfaces trên đều extend từ <code class="language-plaintext highlighter-rouge">StreamerInterface</code>. Cả 3 đều implement interface method là <code class="language-plaintext highlighter-rouge">setSong()</code> và <code class="language-plaintext highlighter-rouge">stream()</code>, nhưng <code class="language-plaintext highlighter-rouge">TranscodingStreamerInterface</code> sẽ cần thêm <code class="language-plaintext highlighter-rouge">setBitrate()</code> và <code class="language-plaintext highlighter-rouge">setStartTime()</code>.</li>
</ul>

<p>Khi sử dụng, có 1 logic lựa chọn streamer như sau:</p>

<ul>
  <li>Nếu thông số của S3 được set thì sẽ chọn <code class="language-plaintext highlighter-rouge">ObjectStorageStreamerInterface</code>;</li>
  <li>Nếu không, thì xem tiếp có cần transcoding không? Nếu có thì set bitrate và start time, rồi chọn <code class="language-plaintext highlighter-rouge">TranscodingStreamerInterface</code></li>
  <li>Nếu không cần transcoding thì chọn <code class="language-plaintext highlighter-rouge">DirectStreamerInterface</code>.</li>
</ul>

<p>Một logic bao gồm 3 subsystems khác nhau như vậy sẽ rất phức tạp nếu để người dùng can thiệp trực tiếp vào.
Vì vậy, đơn giản nhất là tạo một interface hầu như không chứa code là <code class="language-plaintext highlighter-rouge">StreamerInterface</code> để chạy hàm <code class="language-plaintext highlighter-rouge">stream()</code>.
Chúng ta có thể dùng thêm Factory pattern để ẩn quy trình chọn này đi như sau:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">StreamerFactory</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">DirectStreamerInterface</span> <span class="nv">$directStreamer</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">TranscodingStreamerInterface</span> <span class="nv">$transcodingStreamer</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">ObjectStorageStreamerInterface</span> <span class="nv">$objectStorageStreamer</span><span class="p">;</span>
    
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">createStreamer</span><span class="p">(</span>
        <span class="kt">Song</span> <span class="nv">$song</span><span class="p">,</span>
        <span class="kt">?bool</span> <span class="nv">$transcode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="kt">?int</span> <span class="nv">$bitRate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="kt">float</span> <span class="nv">$startTime</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="p">):</span> <span class="kt">StreamerInterface</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$song</span><span class="o">-&gt;</span><span class="n">s3_params</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">objectStorageStreamer</span><span class="o">-&gt;</span><span class="nf">setSong</span><span class="p">(</span><span class="nv">$song</span><span class="p">);</span>

            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">objectStorageStreamer</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$transcode</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingService</span><span class="o">-&gt;</span><span class="nf">songShouldBeTranscoded</span><span class="p">(</span><span class="nv">$song</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$transcode</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$transcode</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingStreamer</span><span class="o">-&gt;</span><span class="nf">setSong</span><span class="p">(</span><span class="nv">$song</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingStreamer</span><span class="o">-&gt;</span><span class="nf">setBitRate</span><span class="p">(</span><span class="nv">$bitRate</span> <span class="o">?:</span> <span class="nf">config</span><span class="p">(</span><span class="s1">'koel.streaming.bitrate'</span><span class="p">));</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingStreamer</span><span class="o">-&gt;</span><span class="nf">setStartTime</span><span class="p">(</span><span class="nv">$startTime</span><span class="p">);</span>

            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">transcodingStreamer</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">directStreamer</span><span class="o">-&gt;</span><span class="nf">setSong</span><span class="p">(</span><span class="nv">$song</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">directStreamer</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Khi sử dụng, chúng ta chỉ cần quan tâm tới <code class="language-plaintext highlighter-rouge">StreamerInterface-&gt;stream()</code> mà không cần quan tâm tới những xử lý chi tiết bên dưới.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">PlayController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">StreamerFactory</span> <span class="nv">$streamerFactory</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">StreamerFactory</span> <span class="nv">$streamerFactory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">streamerFactory</span> <span class="o">=</span> <span class="nv">$streamerFactory</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">show</span><span class="p">(</span><span class="kt">SongPlayRequest</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Song</span> <span class="nv">$song</span><span class="p">,</span> <span class="kt">?bool</span> <span class="nv">$transcode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="kt">?int</span> <span class="nv">$bitRate</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">streamerFactory</span>
            <span class="o">-&gt;</span><span class="nf">createStreamer</span><span class="p">(</span><span class="nv">$song</span><span class="p">,</span> <span class="nv">$transcode</span><span class="p">,</span> <span class="nv">$bitRate</span><span class="p">,</span> <span class="nb">floatval</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="nf">stream</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Thiết kế trên giảm độ phức tạp hệ thống mà khiến cho mỗi streamer chỉ cần quan tâm đến các hàm mà mình cần, không phải chung với các streamer khác.</p>

<h1 id="quy-tắc-thuần-nhất-common-closure-principle">Quy tắc thuần nhất (Common Closure Principle)</h1>

<h2 id="ví-dụ-đời-sống-chung-và-riêng">Ví dụ đời sống: Chung và Riêng</h2>

<p>Trong đời sống có khá nhiều ví dụ về CCP.
Một team làm việc có cả kế toán, nhân sự, lập trình viên, quản lý, …
Vậy <strong>lịch họp sẽ trở thành thế nào?</strong>
Một đội quân ô hợp như vậy thì nếu họp chung thì sẽ mỗi người một ý.
Bây giờ giả sử bạn yêu cầu tất cả bỏ phiếu chọn ra 1 ngày để họp thì sẽ thấy ngay:
những người quản lý thường sẽ chọn đầu hoặc cuối tuần làm việc để tiện cho nắm bắt cả team.
Nhưng những người làm sales thì lại hay phải ra ngoài, họ sẽ bị phụ thuộc vào khách.
Lập trình viên thì lại bị chi phối bởi deadline giao hàng.
Kết cục, là chuyện không thể tìm được 1 ngày khiến tất cả vui vẻ.
Ngoài ra khi đã chọn được một ngày chung, thì sẽ rất khó với vấn đề thay đổi: nhân viên bán hàng có thể thay đổi theo lịch của khách mà quản lý và lập trình viên hầu như không thay đổi.
Như vậy, bạn sẽ phải đối ứng với gấp 3 lần sự thay đổi nếu chỉ lên lịch cho 1 team chỉ toàn lập trình viên đang chạy theo 1 dự án cùng nhau.</p>

<p><strong>Chung</strong> là tốt nhưng phải là chung với những người <strong>giống mình</strong> về thời điểm thay đổi và lý do thay đổi!
Còn nếu không thì phải tách <strong>riêng</strong> những người <strong>khác mình</strong> ra.</p>

<p>Common Closure Principle là quy tắc khép kín thành phần phần mềm chỉ bao gồm những class hay module phần mềm giống nhau về thời điểm cũng như lý do thay đổi.
Một nguyên tắc trong các dự án phần mềm là <strong>bảo trì bao giờ cũng quan trọng hơn tái sử dụng</strong>.
Để cho việc bảo trì và vận hành trở nên dễ dàng, thiết kế các thành phần theo CCP là việc cần làm.</p>

<h2 id="ví-dụ-kỹ-thuật-tại-sao-phải-phân-chia-backendfrontend-serverclient">Ví dụ kỹ thuật: Tại sao phải phân chia backend/frontend, server/client?</h2>

<p>Kiến trúc server/client, hay gần đây đôi khi biến hình thành kiểu backend/frontend cũng không còn xa lạ.
Nhìn chung, sẽ có hai nhóm xử lý quan trọng trong dự án phần mềm web: một là những xử lý đặt tại server (hoặc gần đây là serverless, auto-scaling clusters), và một là những xử lý cho client đặt tại thiết bị người dùng (PC, mobile, tablets, …).
Theo quy tắc CCP và SRP, chuyện tách riêng hai nhóm này ra là chuyện nên làm.
Và trong thực tế, kể cả trên thị trường tuyển dụng, việc tuyển người riêng cho từng thành phần backend và frontend cũng là xu hướng thường thấy, và bị chi phối bởi luật CCP/SRP.</p>

<h1 id="kết-luận">Kết luận</h1>

<p>Hai quy tắc mà chúng ta thảo luận ngày hôm nay là khá cơ bản với mọi kỹ sư phần mềm bài bản.
Chúng ta có thể nhìn thấy những điểm sau từ SRP và CCP:</p>

<ul>
  <li>Bảo trì luôn quan trọng hơn tái sử dụng, đặc biệt là khi vận hành.</li>
  <li>Nên xếp những thứ giống nhau vào cùng một rọ, chứ đừng tạo ra những cái rọ ô hợp trong phần mềm.</li>
  <li>Facade là một thói quen cho lập trình viên hoặc thiết kế phần mềm khi đối đầu với một dự án phần mềm phức tạp.</li>
</ul>

<h1 id="tài-liệu-tham-khảo">Tài liệu tham khảo</h1>

<ol class="bibliography"><li><span id="HumbleOb26:online"><i>Humble Object at XUnitPatterns.com</i>. http://xunitpatterns.com/Humble%20Object.html.</span></li>
<li><span id="cleanarch">Martin, R. C. (2017). <i>Clean Architecture - A Craftman’s Guide to Software Structure and Design</i>. Prentice Hall.</span></li>
<li><span id="martin2009clean">Martin, R. C. (2009). <i>Clean code: a handbook of agile software craftsmanship</i>. Pearson Education.</span></li>
<li><span id="martin2007professionalism">Martin, R. C. (2007). Professionalism and test-driven development. <i>IEEE Software</i>, <i>24</i>(3), 32–36.</span></li>
<li><span id="binder2000testing">Binder, R. (2000). <i>Testing object-oriented systems: models, patterns, and tools</i>. Addison-Wesley Professional.</span></li>
<li><span id="abstraction1988hierarchy">Liskov, B. (1988). Data Abstraction and Hierarchy. <i>SIGPLAN Notices</i>, <i>23</i>(5), 17–34.</span></li></ol>

    



<div class="post-tags">
  
    
    <a href="/tags.html#site-reliability-engineering">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">site reliability engineering</span>
    </a>
  
    
    <a href="/tags.html#devops">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">devops</span>
    </a>
  
    
    <a href="/tags.html#programming">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">programming</span>
    </a>
  
    
    <a href="/tags.html#software-architecture">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">software architecture</span>
    </a>
  
    
    <a href="/tags.html#single-responsibility-principle">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">single responsibility principle</span>
    </a>
  
    
    <a href="/tags.html#solid">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">SOLID</span>
    </a>
  
    
    <a href="/tags.html#common-closure-principle">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">common closure principle</span>
    </a>
  
    
    <a href="/tags.html#component-cohesion">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">component cohesion</span>
    </a>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    
  <div id="disqus_thread">
    <button class="disqus-load" onClick="loadDisqusComments()">
      Load Comments
    </button>
  </div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW
  *  TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:s
  *  https://disqus.com/admin/universalcode/#configuration-variables
  */
  var disqus_config = function () {
    this.page.url = "https://wanted2.github.io/sre/non-english/se/2021/08/07/srp-ccp.html";
    this.page.identifier = "" ||
                           "https://wanted2.github.io/sre/non-english/se/2021/08/07/srp-ccp.html";
  }
  function loadDisqusComments() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//caineng.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  }
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.
  </noscript>



  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/non-english/se/sre/2021/12/05/write-logs.html">
            Học cách viết log nghiêm chỉnh
            <small>05 Dec 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/non-english/se/pm/2021/11/27/fullstask-engineer-and-lean-startup.html">
            Why lean startups love fullstack engineers?
            <small>27 Nov 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/non-english/se/pm/ai/2021/11/20/chicken-and-egg-problem.html">
            Quả trứng và con gà: cái nào có trước? - Bất bình đẳng về lương và sản lượng lao động
            <small>20 Nov 2021</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

    <script src="https://kit.fontawesome.com/d0b91d895e.js" crossorigin="anonymous"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          processEscapes: true
        }
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
  </body>
</html>
